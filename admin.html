<!DOCTYPE html>
<html lang="ar">
<head>
  <meta charset="UTF-8" />
  <title>لوحة الإدارة - ANUBIS</title>
  <link rel="stylesheet" href="style.css" />
</head>
<body>
  <h1>⚙️ لوحة إدارة ANUBIS</h1>

  <div id="loginScreen" class="admin-container">
    <p>يرجى إدخال بيانات الدخول للوصول إلى لوحة التحكم</p>
    <input type="text" id="loginUser" placeholder="اسم المستخدم" value="admin"><br>
    <input type="password" id="loginPass" placeholder="كلمة المرور"><br>
    <button id="btnLogin">دخول</button>
  </div>

  <div id="adminPanel" class="hidden admin-container">
    <h3>إدارة المحتوى</h3>

    <div class="card">
      <h4>➕ إضافة بائع جديد</h4>
      <input id="countryName" placeholder="الدولة"><br>
      <input id="sellerName" placeholder="اسم البائع"><br>
      <textarea id="sellerDesc" placeholder="الوصف"></textarea><br>
      <input id="telegram" placeholder="رابط تيليجرام"><br>
      <input id="whatsapp" placeholder="رابط واتساب"><br>
      <label><input type="checkbox" id="verified"> بائع موثّق ✅</label><br>
      <button id="btnAddSeller">إضافة البائع</button>
    </div>

    <div class="card">
      <h4>➕ إضافة منتج جديد</h4>
      <input id="prodName" placeholder="اسم المنتج"><br>
      <input id="prodPrice" placeholder="السعر"><br>
      <input id="prodImage" placeholder="رابط صورة المنتج"><br>
      <textarea id="prodDetails" placeholder="تفاصيل المنتج"></textarea><br>
      <button id="btnAddProduct">إضافة المنتج</button>
    </div>

    <div class="card">
      <h4>📋 قائمة البائعين</h4>
      <div id="sellersTable"></div>
    </div>

    <div class="card">
      <h4>🛍️ قائمة المنتجات</h4>
      <div id="productsTable"></div>
    </div>

    <button onclick="logout()">🚪 تسجيل خروج</button>
  </div>

  <script>
    const API = '/api';
    const loginScreen = document.getElementById('loginScreen');
    const adminPanel = document.getElementById('adminPanel');

    async function login() {
      const username = document.getElementById('loginUser').value.trim();
      const password = document.getElementById('loginPass').value.trim();
      const res = await fetch(API + '/admin/login', {
        method: 'POST',
        headers: {'Content-Type': 'application/json'},
        body: JSON.stringify({username, password})
      });
      const data = await res.json();
      if (data.success) {
        localStorage.setItem('admin_token', data.token);
        loginScreen.classList.add('hidden');
        adminPanel.classList.remove('hidden');
        loadAll();
      } else {
        alert(data.error || 'فشل تسجيل الدخول');
      }
    }

    async function loadAll() {
      await loadSellers();
      await loadProducts();
    }

    async function loadSellers() {
      const res = await fetch(API + '/sellers');
      const sellers = await res.json();
      const div = document.getElementById('sellersTable');
      div.innerHTML = '';
      sellers.forEach(s => {
        const el = document.createElement('div');
        el.className = 'seller-row';
        el.innerHTML = `<strong>${s.country}</strong> - ${s.name} ${s.verified ? '✅' : ''} 
        | 📛 شكاوى: ${s.complaints || 0}
        <button onclick="deleteSeller(${s.id})">❌ حذف</button>`;
        div.appendChild(el);
      });
    }

    async function loadProducts() {
      const res = await fetch(API + '/products');
      const prods = await res.json();
      const div = document.getElementById('productsTable');
      div.innerHTML = '';
      prods.forEach(p => {
        const el = document.createElement('div');
        el.className = 'seller-row';
        el.innerHTML = `<strong>${p.name}</strong> | ${p.price}<br>
        <img src="${p.image || ''}" style="max-width:80px"><br>
        ${p.details || ''}
        <button onclick="deleteProduct(${p.id})">❌ حذف</button>`;
        div.appendChild(el);
      });
    }

    async function addSeller() {
      const payload = {
        country: countryName.value,
        name: sellerName.value,
        desc: sellerDesc.value,
        telegram: telegram.value,
        whatsapp: whatsapp.value,
        verified: verified.checked
      };
      const res = await fetch(API + '/seller', {method:'POST', headers:{'Content-Type':'application/json'}, body:JSON.stringify(payload)});
      const data = await res.json();
      if (data.success) { alert('تمت الإضافة'); loadSellers(); }
      else alert(data.error || 'خطأ');
    }

    async function addProduct() {
      const payload = {
        name: prodName.value,
        price: prodPrice.value,
        image: prodImage.value,
        details: prodDetails.value
      };
      const res = await fetch(API + '/product', {method:'POST', headers:{'Content-Type':'application/json'}, body:JSON.stringify(payload)});
      const data = await res.json();
      if (data.success) { alert('تمت الإضافة'); loadProducts(); }
      else alert(data.error || 'خطأ');
    }

    async function deleteSeller(id) {
      if (!confirm('هل أنت متأكد؟')) return;
      await fetch(API + '/seller/' + id, {method:'DELETE'});
      loadSellers();
    }
    async function deleteProduct(id) {
      if (!confirm('هل أنت متأكد؟')) return;
      await fetch(API + '/product/' + id, {method:'DELETE'});
      loadProducts();
    }

    function logout() {
      localStorage.removeItem('admin_token');
      adminPanel.classList.add('hidden');
      loginScreen.classList.remove('hidden');
    }

    document.getElementById('btnLogin').onclick = login;
    document.getElementById('btnAddSeller').onclick = addSeller;
    document.getElementById('btnAddProduct').onclick = addProduct;
  </script>
</body>
</html>
