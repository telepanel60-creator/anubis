<!DOCTYPE html>
<html lang="ar">
<head>
  <meta charset="UTF-8" />
  <title>Ù„ÙˆØ­Ø© Ø§Ù„Ø¥Ø¯Ø§Ø±Ø© - ANUBIS</title>
  <link rel="stylesheet" href="style.css" />
</head>
<body>
  <h1>âš™ï¸ Ù„ÙˆØ­Ø© Ø¥Ø¯Ø§Ø±Ø© ANUBIS</h1>

  <div id="loginScreen" class="admin-container">
    <p>ÙŠØ±Ø¬Ù‰ Ø¥Ø¯Ø®Ø§Ù„ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø¯Ø®ÙˆÙ„ Ù„Ù„ÙˆØµÙˆÙ„ Ø¥Ù„Ù‰ Ù„ÙˆØ­Ø© Ø§Ù„ØªØ­ÙƒÙ…</p>
    <input type="text" id="loginUser" placeholder="Ø§Ø³Ù… Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…" value="admin"><br>
    <input type="password" id="loginPass" placeholder="ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±"><br>
    <button id="btnLogin">Ø¯Ø®ÙˆÙ„</button>
  </div>

  <div id="adminPanel" class="hidden admin-container">
    <h3>Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù…Ø­ØªÙˆÙ‰</h3>

    <div class="card">
      <h4>â• Ø¥Ø¶Ø§ÙØ© Ø¨Ø§Ø¦Ø¹ Ø¬Ø¯ÙŠØ¯</h4>
      <input id="countryName" placeholder="Ø§Ù„Ø¯ÙˆÙ„Ø©"><br>
      <input id="sellerName" placeholder="Ø§Ø³Ù… Ø§Ù„Ø¨Ø§Ø¦Ø¹"><br>
      <textarea id="sellerDesc" placeholder="Ø§Ù„ÙˆØµÙ"></textarea><br>
      <input id="telegram" placeholder="Ø±Ø§Ø¨Ø· ØªÙŠÙ„ÙŠØ¬Ø±Ø§Ù…"><br>
      <input id="whatsapp" placeholder="Ø±Ø§Ø¨Ø· ÙˆØ§ØªØ³Ø§Ø¨"><br>
      <label><input type="checkbox" id="verified"> Ø¨Ø§Ø¦Ø¹ Ù…ÙˆØ«Ù‘Ù‚ âœ…</label><br>
      <button id="btnAddSeller">Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ø¨Ø§Ø¦Ø¹</button>
    </div>

    <div class="card">
      <h4>â• Ø¥Ø¶Ø§ÙØ© Ù…Ù†ØªØ¬ Ø¬Ø¯ÙŠØ¯</h4>
      <input id="prodName" placeholder="Ø§Ø³Ù… Ø§Ù„Ù…Ù†ØªØ¬"><br>
      <input id="prodPrice" placeholder="Ø§Ù„Ø³Ø¹Ø±"><br>
      <input id="prodImage" placeholder="Ø±Ø§Ø¨Ø· ØµÙˆØ±Ø© Ø§Ù„Ù…Ù†ØªØ¬"><br>
      <textarea id="prodDetails" placeholder="ØªÙØ§ØµÙŠÙ„ Ø§Ù„Ù…Ù†ØªØ¬"></textarea><br>
      <button id="btnAddProduct">Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ù…Ù†ØªØ¬</button>
    </div>

    <div class="card">
      <h4>ğŸ“‹ Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ø¨Ø§Ø¦Ø¹ÙŠÙ†</h4>
      <div id="sellersTable"></div>
    </div>

    <div class="card">
      <h4>ğŸ›ï¸ Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª</h4>
      <div id="productsTable"></div>
    </div>

    <button onclick="logout()">ğŸšª ØªØ³Ø¬ÙŠÙ„ Ø®Ø±ÙˆØ¬</button>
  </div>

  <script>
    const API = '/api';
    const loginScreen = document.getElementById('loginScreen');
    const adminPanel = document.getElementById('adminPanel');

    async function login() {
      const username = document.getElementById('loginUser').value.trim();
      const password = document.getElementById('loginPass').value.trim();
      const res = await fetch(API + '/admin/login', {
        method: 'POST',
        headers: {'Content-Type': 'application/json'},
        body: JSON.stringify({username, password})
      });
      const data = await res.json();
      if (data.success) {
        localStorage.setItem('admin_token', data.token);
        loginScreen.classList.add('hidden');
        adminPanel.classList.remove('hidden');
        loadAll();
      } else {
        alert(data.error || 'ÙØ´Ù„ ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„');
      }
    }

    async function loadAll() {
      await loadSellers();
      await loadProducts();
    }

    async function loadSellers() {
      const res = await fetch(API + '/sellers');
      const sellers = await res.json();
      const div = document.getElementById('sellersTable');
      div.innerHTML = '';
      sellers.forEach(s => {
        const el = document.createElement('div');
        el.className = 'seller-row';
        el.innerHTML = `<strong>${s.country}</strong> - ${s.name} ${s.verified ? 'âœ…' : ''} 
        | ğŸ“› Ø´ÙƒØ§ÙˆÙ‰: ${s.complaints || 0}
        <button onclick="deleteSeller(${s.id})">âŒ Ø­Ø°Ù</button>`;
        div.appendChild(el);
      });
    }

    async function loadProducts() {
      const res = await fetch(API + '/products');
      const prods = await res.json();
      const div = document.getElementById('productsTable');
      div.innerHTML = '';
      prods.forEach(p => {
        const el = document.createElement('div');
        el.className = 'seller-row';
        el.innerHTML = `<strong>${p.name}</strong> | ${p.price}<br>
        <img src="${p.image || ''}" style="max-width:80px"><br>
        ${p.details || ''}
        <button onclick="deleteProduct(${p.id})">âŒ Ø­Ø°Ù</button>`;
        div.appendChild(el);
      });
    }

    async function addSeller() {
      const payload = {
        country: countryName.value,
        name: sellerName.value,
        desc: sellerDesc.value,
        telegram: telegram.value,
        whatsapp: whatsapp.value,
        verified: verified.checked
      };
      const res = await fetch(API + '/seller', {method:'POST', headers:{'Content-Type':'application/json'}, body:JSON.stringify(payload)});
      const data = await res.json();
      if (data.success) { alert('ØªÙ…Øª Ø§Ù„Ø¥Ø¶Ø§ÙØ©'); loadSellers(); }
      else alert(data.error || 'Ø®Ø·Ø£');
    }

    async function addProduct() {
      const payload = {
        name: prodName.value,
        price: prodPrice.value,
        image: prodImage.value,
        details: prodDetails.value
      };
      const res = await fetch(API + '/product', {method:'POST', headers:{'Content-Type':'application/json'}, body:JSON.stringify(payload)});
      const data = await res.json();
      if (data.success) { alert('ØªÙ…Øª Ø§Ù„Ø¥Ø¶Ø§ÙØ©'); loadProducts(); }
      else alert(data.error || 'Ø®Ø·Ø£');
    }

    async function deleteSeller(id) {
      if (!confirm('Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ØŸ')) return;
      await fetch(API + '/seller/' + id, {method:'DELETE'});
      loadSellers();
    }
    async function deleteProduct(id) {
      if (!confirm('Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ØŸ')) return;
      await fetch(API + '/product/' + id, {method:'DELETE'});
      loadProducts();
    }

    function logout() {
      localStorage.removeItem('admin_token');
      adminPanel.classList.add('hidden');
      loginScreen.classList.remove('hidden');
    }

    document.getElementById('btnLogin').onclick = login;
    document.getElementById('btnAddSeller').onclick = addSeller;
    document.getElementById('btnAddProduct').onclick = addProduct;
  </script>
</body>
</html>
